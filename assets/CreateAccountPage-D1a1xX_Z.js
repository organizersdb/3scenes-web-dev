import{r,j as e,T as re,f as se,g as ae,B as C,M as K}from"./index-DRR2ciDs.js";import{u as ie,T as oe,b as S,C as le}from"./Input-B6_56Pay.js";import{R as Z,S as ce}from"./RadioGroup-B9-TZJ69.js";import{S as de}from"./Separator-C5vIcpzW.js";import{P as J}from"./const-BVb3WmEt.js";import{F as ue}from"./FullScreenLoading-Bp5CqUL4.js";var pe=({as:a="div",...d},o)=>e.jsx(a,{...d,ref:o}),xe=r.forwardRef(pe),fe="https://challenges.cloudflare.com/turnstile/v0/api.js",V="cf-turnstile-script",me="cf-turnstile",H="onloadTurnstileCallback",Q=a=>!!document.getElementById(a),he=({render:a="explicit",onLoadCallbackName:d=H,scriptOptions:{nonce:o="",defer:t=!0,async:p=!0,id:x="",appendTo:g,onError:E,crossOrigin:y=""}={}})=>{let k=x||V;if(Q(k))return;let c=document.createElement("script");c.id=k,c.src=`${fe}?onload=${d}&render=${a}`,!document.querySelector(`script[src="${c.src}"]`)&&(c.defer=!!t,c.async=!!p,o&&(c.nonce=o),y&&(c.crossOrigin=y),E&&(c.onerror=E,delete window[d]),(g==="body"?document.body:document.getElementsByTagName("head")[0]).appendChild(c))},T={normal:{width:300,height:65},compact:{width:150,height:140},invisible:{width:0,height:0,overflow:"hidden"},flexible:{minWidth:300,width:"100%",height:65},interactionOnly:{width:"fit-content",height:"auto",display:"flex"}};function ge(a){if(a!=="invisible"&&a!=="interactionOnly")return a}function ye(a=V){let[d,o]=r.useState(!1);return r.useEffect(()=>{let t=()=>{Q(a)&&o(!0)},p=new MutationObserver(t);return p.observe(document,{childList:!0,subtree:!0}),t(),()=>{p.disconnect()}},[a]),d}var F="unloaded",Y,be=new Promise((a,d)=>{Y={resolve:a,reject:d},F==="ready"&&a(void 0)}),je=(a=H)=>(F==="unloaded"&&(F="loading",window[a]=()=>{Y.resolve(),F="ready",delete window[a]}),be),X=r.forwardRef((a,d)=>{let{scriptOptions:o,options:t={},siteKey:p,onWidgetLoad:x,onSuccess:g,onExpire:E,onError:y,onBeforeInteractive:k,onAfterInteractive:c,onUnsupported:f,onTimeout:q,onLoadScript:A,id:m,style:B,as:l="div",injectScript:M=!0,...z}=a,u=t.size,R=r.useCallback(()=>typeof u>"u"?{}:t.execution==="execute"?T.invisible:t.appearance==="interaction-only"?T.interactionOnly:T[u],[t.execution,u,t.appearance]),[P,w]=r.useState(R()),h=r.useRef(null),[i,L]=r.useState(!1),s=r.useRef(),v=r.useRef(!1),U=m||me,D=(o==null?void 0:o.id)||V,$=ye(D),W=(o==null?void 0:o.onLoadCallbackName)||H,ee=t.appearance||"always",I=r.useMemo(()=>({sitekey:p,action:t.action,cData:t.cData,callback:n=>{v.current=!0,g==null||g(n)},"error-callback":y,"expired-callback":E,"before-interactive-callback":k,"after-interactive-callback":c,"unsupported-callback":f,theme:t.theme||"auto",language:t.language||"auto",tabindex:t.tabIndex,"response-field":t.responseField,"response-field-name":t.responseFieldName,size:ge(u),retry:t.retry||"auto","retry-interval":t.retryInterval||8e3,"refresh-expired":t.refreshExpired||"auto","refresh-timeout":t.refreshTimeout||"auto",execution:t.execution||"render",appearance:t.appearance||"always","feedback-enabled":t.feedbackEnabled||!0,"timeout-callback":q}),[t.action,t.appearance,t.cData,t.execution,t.language,t.refreshExpired,t.responseField,t.responseFieldName,t.retry,t.retryInterval,t.tabIndex,t.theme,t.feedbackEnabled,t.refreshTimeout,p,u]),N=r.useCallback(()=>typeof window<"u"&&!!window.turnstile,[]);return r.useEffect(function(){M&&!i&&he({onLoadCallbackName:W,scriptOptions:{...o,id:D}})},[M,i,o,D]),r.useEffect(function(){F!=="ready"&&je(W).then(()=>L(!0)).catch(console.error)},[]),r.useEffect(function(){if(!h.current||!i)return;let n=!1;return(async()=>{if(n||!h.current)return;let b=window.turnstile.render(h.current,I);s.current=b,s.current&&(x==null||x(s.current))})(),()=>{n=!0,s.current&&(window.turnstile.remove(s.current),v.current=!1)}},[U,i,I]),r.useImperativeHandle(d,()=>{let{turnstile:n}=window;return{getResponse(){if(!(n!=null&&n.getResponse)||!s.current||!N()){console.warn("Turnstile has not been loaded");return}return n.getResponse(s.current)},async getResponsePromise(b=3e4,te=100){return new Promise((ne,G)=>{let j,_=async()=>{if(v.current&&window.turnstile&&s.current)try{let O=window.turnstile.getResponse(s.current);return j&&clearTimeout(j),O?ne(O):G(new Error("No response received"))}catch(O){return j&&clearTimeout(j),console.warn("Failed to get response",O),G(new Error("Failed to get response"))}j||(j=setTimeout(()=>{j&&clearTimeout(j),G(new Error("Timeout"))},b)),await new Promise(O=>setTimeout(O,te)),await _()};_()})},reset(){if(!(n!=null&&n.reset)||!s.current||!N()){console.warn("Turnstile has not been loaded");return}t.execution==="execute"&&w(T.invisible);try{v.current=!1,n.reset(s.current)}catch(b){console.warn(`Failed to reset Turnstile widget ${s}`,b)}},remove(){if(!(n!=null&&n.remove)||!s.current||!N()){console.warn("Turnstile has not been loaded");return}w(T.invisible),v.current=!1,n.remove(s.current),s.current=null},render(){if(!(n!=null&&n.render)||!h.current||!N()||s.current){console.warn("Turnstile has not been loaded or container not found");return}let b=n.render(h.current,I);return s.current=b,s.current&&(x==null||x(s.current)),t.execution!=="execute"&&w(u?T[u]:{}),b},execute(){if(t.execution!=="execute"){console.warn('Execution mode is not set to "execute"');return}if(!(n!=null&&n.execute)||!h.current||!s.current||!N()){console.warn("Turnstile has not been loaded or container not found");return}n.execute(h.current,I),w(u?T[u]:{})},isExpired(){return!(n!=null&&n.isExpired)||!s.current||!N()?(console.warn("Turnstile has not been loaded"),!1):n.isExpired(s.current)}}},[s,t.execution,u,I,h,N,i,x]),r.useEffect(()=>{$&&!i&&window.turnstile&&L(!0)},[i,$]),r.useEffect(()=>{w(R())},[t.execution,u,ee]),r.useEffect(()=>{!$||typeof A!="function"||A()},[$]),e.jsx(xe,{ref:h,as:l,id:U,style:{...P,...B},...z})});X.displayName="Turnstile";const ke=()=>{const{showAlert:a}=r.useContext(re),{registerAccount:d}=r.useContext(se),o=r.useRef(null),t=r.useRef(null),p=ae(),[x,g]=r.useState(!1),[E,y]=r.useState(!1),[k,c]=r.useState(!1),{register:f,trigger:q,formState:{isDirty:A,errors:m},handleSubmit:B,watch:l,control:M}=ie({mode:"onChange",defaultValues:{countryCode:J[0]}}),{ref:z,...u}=f("companyFile"),R=l("companyFile"),P=r.useCallback(async()=>{p("/acknowledgement",{state:{initialCountdown:3,heading:"你的開户申請已成功遞交！",paragraphs:["3scenes.io 將會於 3 個工作天內審閱申請，成功申請後你將會收到電郵通知。","如有任何查詢，請聯絡 info@3scenes.io"],countdownText:"頁面將於{countdown}秒後返回主頁",redirectPath:"/"}})},[p]),w=r.useCallback(()=>{y(!0)},[]),h=r.useCallback(async i=>{if(t.current===null)return;c(!0);const L=await t.current.getResponsePromise();if(L){const s={...i,representativeMobile:`${i.countryCode}${i.phone}`},v=await d(s,L);c(!1),v?P():(y(!1),a({severity:"ERROR",content:"抱歉，系統遇到技術問題，請稍後重試。若問題持續，請與我們聯絡。"}))}else c(!1)},[P,d,a]);return k?e.jsx(ue,{}):e.jsx("div",{className:"flex max-w-2xl justify-center",children:e.jsxs("form",{className:"flex max-w-lg flex-col",children:[e.jsx("h1",{className:"text-center font-sans text-xl font-bold md:text-left md:text-3xl",children:"歡迎註冊 3scenes 帳户"}),e.jsx(de,{className:"hidden md:block"}),e.jsx("p",{children:"無論你是電影公司 / 編劇均可在本平台尋找下一個機會！加入 3scenes 只需幾項資料："}),e.jsxs("div",{className:"mt-12 flex flex-col gap-y-16",children:[e.jsxs("section",{children:[e.jsxs("div",{className:"flex items-center gap-x-2",children:[e.jsx("h2",{className:"text-xl font-bold",children:"你用甚麼身分使用平台？"}),e.jsx(oe,{dataToolTipId:"identity-tooltip",content:e.jsxs(e.Fragment,{children:[e.jsx("p",{children:"電影公司可在平台發佈徵稿啟事，並可建立更多分帳户管理工作。"}),e.jsx("p",{children:"編劇可在平台用參與活動，獲得工作機會，並在此管理合作，更有保障。"})]})})]}),e.jsx("div",{className:"flex flex-col gap-y-6 py-9",children:e.jsx(Z,{label:"選擇你的身份（單選）：",fieldName:"identity",options:[{label:"電影公司",value:"電影公司"},{label:"編劇",value:"編劇"}],register:f,watch:l,errors:m,validation:{required:"請選擇你的身份"}})})]}),l("identity")&&e.jsxs("section",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"公司資料"}),e.jsxs("div",{className:"flex flex-col gap-y-6 py-9",children:[l("identity")==="編劇"&&e.jsx(Z,{label:"",fieldName:"isCompany",options:[{label:"我是自由工作者，沒法提供公司資料。",value:"我是自由工作者，沒法提供公司資料。"},{label:"我可以提供公司資料。",value:"我可以提供公司資料。"}],register:f,watch:l,errors:m,validation:{required:"請選擇公司資料。"},isVerticalList:!0}),(l("identity")==="編劇"&&l("isCompany")==="我可以提供公司資料。"||l("identity")==="電影公司")&&e.jsxs(e.Fragment,{children:[e.jsx(S,{fieldName:"companyName",register:f,watch:l,errors:m,placeholder:"請填寫公司名稱",maxLength:100,label:"公司名稱"}),e.jsx(S,{fieldName:"companyAddress",register:f,watch:l,errors:m,placeholder:"請填寫公司地址",maxLength:100,label:"公司地址"}),e.jsx(S,{fieldName:"companyBr",register:f,watch:l,errors:m,placeholder:"請填寫商業登記號碼",maxLength:10,label:"商業登記號碼"}),e.jsxs("div",{className:"flex items-center gap-x-4",children:[e.jsx("input",{type:"file",style:{display:"none"},accept:"image/png, image/jpeg, application/pdf",...u,ref:i=>{z(i),o.current=i}}),e.jsx(C,{text:R&&R.length>0?R[0].name:"上載檔案",onClick:()=>{var i;(i=o.current)==null||i.click()}}),e.jsx("span",{children:"支援格式：png、pdf、jpeg"})]}),e.jsx("p",{children:"上載商業登記證，讓 3scenes 認證身份。"})]})]})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-xl font-bold",children:"管理員資料"}),e.jsxs("div",{className:"flex flex-col gap-y-6 py-9",children:[e.jsx(S,{fieldName:"representativeName",register:f,watch:l,errors:m,placeholder:"請填寫聯絡人名稱",maxLength:50,label:"聯絡人名稱",validation:{required:"請填寫聯絡人名稱"}}),e.jsxs("div",{className:"flex items-start gap-x-4",children:[e.jsx(le,{name:"countryCode",control:M,rules:{required:"請選擇電話區碼"},render:({field:i})=>e.jsx(ce,{...i,className:"w-[120px]",options:J,label:"電話區碼",size:"small",errors:m})}),e.jsx(S,{fieldName:"phone",register:f,watch:l,errors:m,placeholder:"請填寫聯絡電話",label:"聯絡電話",validation:{required:"請填寫聯絡電話"}})]}),e.jsx(S,{fieldName:"representativeEmail",register:f,watch:l,errors:m,placeholder:"請填寫登入電郵地址",maxLength:100,label:"登入電郵地址",dataToolTipId:"email-tooltip",toolTipContent:e.jsx("p",{children:"3scenes 暫時只認證 Google、Microsoft 及 Apple 供應的電郵域名，以提供最安全的網站體驗，如有任何查詢，請聯絡 info@3scenes.io"}),validation:{required:"請填寫登入電郵地址"}})]})]}),e.jsxs("section",{className:"flex justify-end gap-x-8 py-10",children:[e.jsx(C,{text:"取消",type:"reset",onClick:()=>g(!0)}),e.jsx(C,{className:`${A?"border-indigo bg-indigo":"bg-zinc-400"} text-white`,text:"提交申請",disabled:!A,onClick:async()=>{await q()&&w()}})]})]}),e.jsx(K,{isOpen:x,onClose:()=>g(!1),children:e.jsxs("div",{className:"mx-auto flex flex-col items-center gap-y-2 py-10 text-center",children:[e.jsx("div",{className:"font-serif text-3xl font-bold",children:"你確定取消提交開啟賬戶申請嗎？"}),e.jsxs("div",{className:"flex gap-x-3",children:[e.jsx(C,{text:"繼續建立",type:"button",onClick:()=>g(!1)}),e.jsx(C,{text:"取消建立",type:"button",onClick:()=>p("/")})]})]})}),e.jsx(K,{isOpen:E,onClose:()=>y(!1),children:e.jsxs("div",{className:"mx-auto flex flex-col items-center gap-y-2 py-10 text-center",children:[e.jsx("div",{className:"font-serif text-3xl font-bold",children:"你確定提交開啟賬戶申請嗎？"}),e.jsx("div",{className:"font-light",children:"申請將由 3scenes 批核"}),e.jsx("div",{className:"h-[70px] w-[330px]",children:e.jsx(X,{ref:t,siteKey:"0x4AAAAAAA4AUAOzEZOeG64g",options:{theme:"light"}})}),e.jsxs("div",{className:"flex gap-x-3",children:[e.jsx(C,{text:"返回",type:"button",onClick:()=>y(!1)}),e.jsx(C,{className:"border-indigo bg-indigo text-white",text:"提交申請",type:"button",onClick:B(h)})]})]})})]})})};export{ke as default};
