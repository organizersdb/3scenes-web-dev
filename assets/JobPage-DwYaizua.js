import{r as c,j as e,k as w,f as v,M as b,J as k,g as L,B as D,l as M}from"./index-DRR2ciDs.js";import{A as N}from"./Avatar-DzGO4EEC.js";import{S}from"./ProposalContent-DUzlgRCN.js";import{O as y}from"./OpportunityDetail-CnR58Gq9.js";import{P as V}from"./ProposalDetail-CSYVgAj3.js";import{B as _}from"./Back-D9ukjQ2Z.js";import"./Separator-C5vIcpzW.js";import"./SceneCard-CIrGpZac.js";import"./index-CDqgC5ys.js";const j="dropdown-toggle",H=i=>{window.dispatchEvent(new CustomEvent(j,{detail:i}))};function B({items:i}){const[t,s]=c.useState(!1),r=crypto.randomUUID(),n=c.useRef(null);c.useEffect(()=>{const l=d=>{d.detail!==r&&s(!1)},a=d=>{n.current&&!n.current.contains(d.target)&&s(!1)};return window.addEventListener(j,l),document.addEventListener("mousedown",a),()=>{window.removeEventListener(j,l),document.removeEventListener("mousedown",a)}},[r]);const x=()=>{const l=!t;s(l),l&&H(r)};return e.jsxs("div",{className:"relative inline-block text-left",ref:n,children:[e.jsx("div",{onClick:x,children:e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("mask",{id:"mask0_3431_1234",maskUnits:"userSpaceOnUse",x:"0",y:"0",width:"24",height:"24",children:e.jsx("rect",{width:"24",height:"24",fill:"#D9D9D9"})}),e.jsx("g",{mask:"url(#mask0_3431_1234)",children:e.jsx("path",{d:"M6 14C5.45 14 4.97917 13.8042 4.5875 13.4125C4.19583 13.0208 4 12.55 4 12C4 11.45 4.19583 10.9792 4.5875 10.5875C4.97917 10.1958 5.45 10 6 10C6.55 10 7.02083 10.1958 7.4125 10.5875C7.80417 10.9792 8 11.45 8 12C8 12.55 7.80417 13.0208 7.4125 13.4125C7.02083 13.8042 6.55 14 6 14ZM12 14C11.45 14 10.9792 13.8042 10.5875 13.4125C10.1958 13.0208 10 12.55 10 12C10 11.45 10.1958 10.9792 10.5875 10.5875C10.9792 10.1958 11.45 10 12 10C12.55 10 13.0208 10.1958 13.4125 10.5875C13.8042 10.9792 14 11.45 14 12C14 12.55 13.8042 13.0208 13.4125 13.4125C13.0208 13.8042 12.55 14 12 14ZM18 14C17.45 14 16.9792 13.8042 16.5875 13.4125C16.1958 13.0208 16 12.55 16 12C16 11.45 16.1958 10.9792 16.5875 10.5875C16.9792 10.1958 17.45 10 18 10C18.55 10 19.0208 10.1958 19.4125 10.5875C19.8042 10.9792 20 11.45 20 12C20 12.55 19.8042 13.0208 19.4125 13.4125C19.0208 13.8042 18.55 14 18 14Z",fill:"#1C1B1F"})})]})}),e.jsx("div",{className:w("absolute right-0 z-10 mt-2 w-56 origin-top-right bg-white focus:outline-none",t?"block":"hidden"),role:"menu","aria-orientation":"vertical","aria-labelledby":"menu-button",tabIndex:-1,children:e.jsx("div",{role:"none",children:i.map((l,a)=>e.jsxs("a",{href:"#",className:w("flex items-center gap-x-2 border-b border-l border-r border-black px-4 py-3",a===0?"border-t":""),role:"menuitem",tabIndex:-1,id:`menu-item-${a}`,onClick:d=>{d.preventDefault(),l.onClick(),s(!1)},children:[l.icon&&e.jsx("span",{className:"flex-shrink-0",children:l.icon}),l.label]},l.id))})})]})}function Z(){return e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("mask",{id:"mask0_3431_1283",maskUnits:"userSpaceOnUse",x:"0",y:"0",width:"24",height:"24",children:e.jsx("rect",{width:"24",height:"24",fill:"#D9D9D9"})}),e.jsx("g",{mask:"url(#mask0_3431_1283)",children:e.jsx("path",{d:"M6 19.5V5.6155C6 5.15517 6.15417 4.77083 6.4625 4.4625C6.77083 4.15417 7.15517 4 7.6155 4H16.3845C16.8448 4 17.2292 4.15417 17.5375 4.4625C17.8458 4.77083 18 5.15517 18 5.6155V19.5L12 16.923L6 19.5ZM7 17.95L12 15.8L17 17.95V5.6155C17 5.4615 16.9359 5.32042 16.8077 5.19225C16.6796 5.06408 16.5385 5 16.3845 5H7.6155C7.4615 5 7.32042 5.06408 7.19225 5.19225C7.06408 5.32042 7 5.4615 7 5.6155V17.95Z",fill:"#1C1B1F"})})]})}function O(){return e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("mask",{id:"mask0_3431_1281",maskUnits:"userSpaceOnUse",x:"0",y:"0",width:"24",height:"24",children:e.jsx("rect",{width:"24",height:"24",fill:"#D9D9D9"})}),e.jsx("g",{mask:"url(#mask0_3431_1281)",children:e.jsx("path",{d:"M12 17.1923L15.3077 13.8845L14.6 13.177L12.5 15.277V10.577H11.5V15.277L9.4 13.177L8.69225 13.8845L12 17.1923ZM5 7.80775V18.3845C5 18.564 5.05767 18.7115 5.173 18.827C5.2885 18.9423 5.436 19 5.6155 19H18.3845C18.564 19 18.7115 18.9423 18.827 18.827C18.9423 18.7115 19 18.564 19 18.3845V7.80775H5ZM5.76925 20C5.32175 20 4.915 19.817 4.549 19.451C4.183 19.085 4 18.6783 4 18.2308V7.4865C4 7.29167 4.03108 7.10833 4.09325 6.9365C4.15542 6.76467 4.24867 6.60633 4.373 6.4615L5.93075 4.5905C6.07558 4.3955 6.25667 4.24833 6.474 4.149C6.69133 4.04967 6.92433 4 7.173 4H16.7885C17.0372 4 17.2733 4.04967 17.497 4.149C17.7208 4.24833 17.9052 4.3955 18.05 4.5905L19.627 6.5C19.7513 6.64483 19.8446 6.80633 19.9068 6.9845C19.9689 7.16283 20 7.34942 20 7.54425V18.2308C20 18.6783 19.817 19.085 19.451 19.451C19.085 19.817 18.6783 20 18.2308 20H5.76925ZM5.38075 6.80775H18.6L17.2693 5.2115C17.2051 5.1475 17.1313 5.09625 17.048 5.05775C16.9647 5.01925 16.8782 5 16.7885 5H7.19225C7.10258 5 7.01608 5.01925 6.93275 5.05775C6.84942 5.09625 6.77567 5.1475 6.7115 5.2115L5.38075 6.80775Z",fill:"#1C1B1F"})})]})}function P(){return e.jsxs("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("mask",{id:"mask0_3431_1279",maskUnits:"userSpaceOnUse",x:"0",y:"0",width:"24",height:"24",children:e.jsx("rect",{width:"24",height:"24",fill:"#D9D9D9"})}),e.jsx("g",{mask:"url(#mask0_3431_1279)",children:e.jsx("path",{d:"M15.3 10.077L18.6712 6.7L18.125 6.15375L15.3 8.97875L13.875 7.573L13.3288 8.125L15.3 10.077ZM4 19.5V18.5H15V19.5H4ZM16.0027 12.5C14.7586 12.5 13.6971 12.0615 12.8182 11.1845C11.9394 10.3077 11.5 9.24708 11.5 8.00275C11.5 6.75858 11.9385 5.69708 12.8155 4.81825C13.6923 3.93942 14.7529 3.5 15.9973 3.5C17.2414 3.5 18.3029 3.9385 19.1818 4.8155C20.0606 5.69233 20.5 6.75292 20.5 7.99725C20.5 9.24142 20.0615 10.3029 19.1845 11.1818C18.3077 12.0606 17.2471 12.5 16.0027 12.5ZM4 11.5V10.5H9.377C9.44233 10.6872 9.51475 10.8609 9.59425 11.0212C9.67375 11.1814 9.76417 11.341 9.8655 11.5H4ZM4 15.5V14.5H13.2655C13.5333 14.618 13.8134 14.7209 14.1058 14.8088C14.3981 14.8966 14.6962 14.961 15 15.002V15.5H4Z",fill:"#1C1B1F"})})]})}const E=({onSelect:i,...t})=>{const{screenwriter:s,script:r,jobId:n,screenwriterId:x}=t,{updateProposal:l}=c.useContext(v),a=async h=>{await l({...t,...h}),window.location.reload()},d=h=>{h.target.closest(".dropdown-wrapper")||i(t)};return e.jsxs("div",{className:"border-b border-black py-8",onClick:d,children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx(N,{name:s==null?void 0:s.name,title:s==null?void 0:s.type,img:s==null?void 0:s.avatar,size:"large"}),e.jsxs("div",{className:"flex items-center gap-x-4",children:[e.jsx(S,{jobId:n,screenwriterId:x}),e.jsx("div",{className:"dropdown-wrapper",onClick:h=>h.stopPropagation(),children:e.jsx(B,{items:[...t.isArchived?[]:[{id:"shortlist",label:t.isShortlisted?"取消標籤":"標籤此申請",icon:e.jsx(Z,{}),onClick:()=>{a({id:t.id,isShortlisted:!t.isShortlisted})}}],...t.isShortlisted?[]:[{id:"archive",label:t.isArchived?"取消封存":"封存此申請",icon:e.jsx(O,{}),onClick:()=>{a({id:t.id,isArchived:!t.isArchived})}}],{id:"view",label:"查看/編輯合約內容",icon:e.jsx(P,{}),onClick:()=>{i(t)}}]})})]})]}),e.jsxs("div",{className:"mt-8 px-16",children:[e.jsxs("div",{children:["故事梗概： ",r==null?void 0:r.logline]}),e.jsxs("div",{className:"mt-4",children:["故事大綱： ",r==null?void 0:r.outline]})]})]})},U=({proposals:i,onSelect:t})=>e.jsx("div",{children:i.map(s=>e.jsx(E,{...s,onSelect:t},s.id))}),u=({proposals:i,onSelect:t,emptyMessage:s})=>e.jsxs("div",{children:[e.jsx("div",{className:"flex justify-between"}),i.length>0?e.jsx(U,{proposals:i,onSelect:t}):e.jsx("div",{className:"flex h-[300px] items-center justify-center",children:s})]}),A=({job:i,isOpen:t,onClose:s})=>i?e.jsx(b,{isOpen:t,onClose:s,className:"p-8 md:h-fit md:w-[90%]",children:e.jsx(y,{...i})}):e.jsx(e.Fragment,{}),G=()=>{var p;const[i,t]=c.useState(!1),[s,r]=c.useState("all"),{job:n,isLoading:x}=c.useContext(k),[l,a]=c.useState(null),d=L(),h=c.useMemo(()=>{var o,g,f;return n?[{label:`所有申請（${((o=n.proposals)==null?void 0:o.length)??0}）`,value:"all"},{label:`已標籤（${((g=n.proposals)==null?void 0:g.filter(({isShortlisted:C})=>C).length)??0}）`,value:"shortlisted"},{label:`已封存（${((f=n.proposals)==null?void 0:f.filter(({isArchived:C})=>C).length)??0}）`,value:"archived"}]:[]},[n]);if(!n||x)return e.jsx("div",{children:"Loading..."});const m=((p=n.proposals)==null?void 0:p.map(o=>({...o,id:o.id})))??[];return e.jsxs(e.Fragment,{children:[e.jsxs("section",{children:[e.jsx(_,{}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"flex items-baseline gap-x-2",children:[e.jsx("h1",{className:"font-serif text-3xl",children:n.title}),e.jsx("button",{className:"text-gray-500 underline",onClick:()=>t(!0),children:"查看細節"})]}),n.status==="draft"&&e.jsx(D,{text:"編輯啟事",onClick:()=>d(`/job/${n.id}/edit`)})]})]}),e.jsxs("section",{children:[e.jsx(M,{options:h,value:s,onChange:o=>r(o)}),s==="all"&&e.jsx(u,{proposals:m,onSelect:o=>a(o),emptyMessage:"噢！你暫未收到申請！"}),s==="shortlisted"&&e.jsx(u,{proposals:m.filter(({isShortlisted:o})=>o),onSelect:a,emptyMessage:"噢！你暫未標籤任何申請！"}),s==="archived"&&e.jsx(u,{proposals:m.filter(({isArchived:o})=>o),onSelect:a,emptyMessage:"噢！你暫未封存任何申請！"})]}),e.jsx(A,{job:n,isOpen:i,onClose:()=>t(!i)}),e.jsx(V,{proposal:l,onClose:()=>a(null)})]})};export{G as default};
